!function(e){function t(n){if(o[n])return o[n].exports;var a=o[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t){"use strict";function o(){function e(e){y=e.get("coords"),v&&v.close(),t()}function t(e){e&&(y=f[e][0].coords),v=c(),v.open(y).then(function(){r(),document.getElementById("closeBalloon").addEventListener("click",function(){v.close()}),document.getElementById("submit").addEventListener("click",n),e&&l(e)})}function o(e,t){var o=s(e,t);i.geoObjects.add(o),m.add(o)}function n(e){var t=document.getElementById("name"),n=document.getElementById("place"),s=document.getElementById("comment");if(t.value||n.value||comment.value){var r={name:t.value,review:s.value,date:d(),place:n.value,address:document.getElementById("address").innerHTML,coords:y};a(r),o(y,r),l(r.address)}}function a(e){f[e.address]||(f[e.address]=[]),f[e.address].push(e)}function l(e){var t=reviewTemplate.innerHTML,o=Handlebars.compile(t),n=o({list:f[e]});document.getElementById("reviews").innerHTML=n}function s(e,t){return new ymaps.Placemark(e,t,{openBalloonOnClick:!1})}function r(){ymaps.geocode([y[0],y[1]],{results:1}).then(function(e){document.getElementById("address").innerHTML=e.geoObjects.get(0).properties.get("text")},function(e){document.getElementById("adress").innerHTML="Address not found"})}function d(){var e=void 0,t=void 0,o=void 0,n=void 0;return e=new Date,t=e.getDate(),o=e.getMonth()+1,n=e.getFullYear(),t<=9&&(t="0"+t),o<=9&&(o="0"+o),t+"."+o+"."+n}function c(){var e=new ymaps.Balloon(i);return e.options.setParent(i.options),e.options.set("layout",u),e}var i=new ymaps.Map("map",{center:[50.4,30.53],zoom:11},{searchControlProvider:"yandex#search"}),u=ymaps.templateLayoutFactory.createClass('\t\t\t<div class="balloon">\t\t\t\t<div id="closeBalloon" style="float: right; cursor: pointer;" >X</div>\t\t\t\t<div id="address" class="balloon__address" style="float: left"></div>\t\t\t\t<div id="reviews" class="baloon__reviews" data-content=0></div>\t\t\t\t<div class="baloon__body"><input type="text" class="form-control balloon__input" id="name" placeholder="Ваше имя">\t\t\t\t<input type="text" class="form-control balloon__input" id="place" placeholder="Укажите место">\t\t\t\t<input type="text" class="form-control balloon__input" id="comment" placeholder="Поделитесь впечатлениями">\t\t\t\t<button id="submit" class="balloon__submit">submit</button></div>\t\t\t</div>',{}),p=ymaps.templateLayoutFactory.createClass('<h2 class=ballon_header> {{properties.place|raw}}</h2><div class=ballon_body><a href="#" id="addressCarousel">{{properties.address|raw}}</a></br>{{properties.review|raw}}</div><div class=ballon_footer>{{properties.date|raw}}</div>'),m=new ymaps.Clusterer({clusterDisableClickZoom:!0,clusterBalloonContentLayout:"cluster#balloonCarousel",clusterBalloonItemContentLayout:p,clusterBalloonPanelMaxMapArea:0,clusterBalloonContentLayoutWidth:200,clusterBalloonContentLayoutHeight:130,clusterBalloonPagerSize:5});i.geoObjects.add(m);var v=void 0,y=void 0,f={};i.events.add("click",e),m.events.add("click",function(e){v.close(),v=m.balloon}),document.addEventListener("click",function(e){"addressCarousel"===e.target.getAttribute("id")&&(v.close(),t(e.target.innerHTML))}),i.geoObjects.events.add("click",function(e){v.close(),t(e.get("target").properties.get("address"))})}ymaps.ready(o)}]);